FROM ansibleplaybookbundle/apb-base:release-1.3

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGNsb3VkbmF0aXZlLXdvcmtzaG9wLXYxLWFwYgpkZXNjcmlwdGlv\
bjogQVBCIHRvIGRlcGxveSByZXF1aXJlZCBpbmZyYSBjb21wb25lbnRzIGZvciB0aGUgQ2xvdWQt\
TmF0aXZlIFdvcmtzaG9wIG9uIGFuIE9wZW5TaGlmdCBjbHVzdGVyCmJpbmRhYmxlOiBGYWxzZQph\
c3luYzogb3B0aW9uYWwKdGFnczoKLSB3b3Jrc2hvcAptZXRhZGF0YToKICBkZXBlbmRlbmNpZXM6\
IFtdCiAgZGlzcGxheU5hbWU6ICJDbG91ZC1OYXRpdmUgV29ya3Nob3AgSW5zdGFsbGVyICh2MSki\
CiAgbG9uZ0Rlc2NyaXB0aW9uOiAiSW5zdGFsbHMgdGhlIGxhYiBpbnN0cnVjdGlvbnMgYW5kIHJl\
cXVpcmVkIGNvbXBvbmVudHMgKEdpdCBzZXJ2ZXIsIE5leHVzLCBFY2xpcHNlIENoZSwgZXRjKSBm\
b3IgcnVubmluZyB0aGUgQ2xvdWQtTmF0aXZlIFdvcmtzaG9wIGh0dHBzOi8vZ2l0aHViLmNvbS9v\
cGVuc2hpZnQtbGFicy9jbG91ZC1uYXRpdmUtZ3VpZGVzIgogIGNvbnNvbGUub3BlbnNoaWZ0Lmlv\
L2ljb25DbGFzczogInBmaWNvbiBwZmljb24tcHJvY2Vzcy1hdXRvbWF0aW9uIgogIHByb3ZpZGVy\
RGlzcGxheU5hbWU6ICJSZWQgSGF0LCBJbmMuIgpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAg\
IGRlc2NyaXB0aW9uOiBEZXBsb3lzIENsb3VkLU5hdGl2ZSBXb3Jrc2hvcCBJbmZyYXN0cnVjdHVy\
ZQogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBEZWZhdWx0\
CiAgICBwYXJhbWV0ZXJzOgogICAgLSBuYW1lOiBvcGVuc2hpZnRfdXNlcgogICAgICB0aXRsZTog\
VXNlcm5hbWUKICAgICAgZGVzY3JpcHRpb246IFVzZXIgaXMgcmVxdWlyZWQgZm9yIGNyZWF0aW5n\
IHByb2plY3QgYWRtaW4gcmVzb3VyY2VzCiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJl\
ZDogdHJ1ZQogICAgICBkaXNwbGF5X2dyb3VwOiBPcGVuU2hpZnQgQWRtaW4gVXNlcgogICAgLSBu\
YW1lOiBvcGVuc2hpZnRfcGFzc3dvcmQKICAgICAgdGl0bGU6IFBhc3N3b3JkCiAgICAgIGRlc2Ny\
aXB0aW9uOiBQYXNzd29yZCBpcyByZXF1aXJlZCBmb3IgY3JlYXRpbmcgcHJvamVjdCBhZG1pbiBy\
ZXNvdXJjZXMKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRp\
c3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgZGlzcGxheV9ncm91cDogT3BlblNoaWZ0IEFkbWlu\
IFVzZXIKICAgIC0gbmFtZTogb3BlbnNoaWZ0X21hc3Rlcl91cmwKICAgICAgdGl0bGU6IE9wZW5T\
aGlmdCBNYXN0ZXIgVVJMCiAgICAgIGRlc2NyaXB0aW9uOiBUaGUgYWRkcmVzcyB0byBPcGVuU2hp\
ZnQgbWFzdGVyIFVSTCB0byBiZSBkaXNwbGF5ZWQgaW4gdGhlIGxhYiBndWlkZSB0byBwYXJ0aWNp\
cGFudHMKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3Bs\
YXlfdHlwZTogc3RyaW5nCiAgICAgIGRpc3BsYXlfZ3JvdXA6IExhYiBHdWlkZQogICAgLSBuYW1l\
OiBvcGVuc2hpZnRfdXNlcl9wYXNzd29yZAogICAgICB0aXRsZTogT3BlblNoaWZ0IFVzZXIgUGFz\
c3dvcmQKICAgICAgZGVzY3JpcHRpb246IFRoZSBPcGVuU2hpZnQgcGFzc3dvcmQgZm9yIHBhcnRp\
Y2lwYW50cyB0byBiZSBkaXNwbGF5ZWQgaW4gdGhlIGxhYiBndWlkZSB0byBwYXJ0aWNpcGFudHMK\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlw\
ZTogc3RyaW5nCiAgICAgIHZhbHVlOiAib3BlbnNoaWZ0IgogICAgICBkaXNwbGF5X2dyb3VwOiBM\
YWIgR3VpZGUKICAgIC0gbmFtZTogaW5mcmFzdmNzX2FkbV91c2VyCiAgICAgIHRpdGxlOiBJbmZy\
YSBTZXJ2aWNlcyBBZG1pbiBVc2VyCiAgICAgIGRlc2NyaXB0aW9uOiBBZG1pbiB1c2VyIGZvciBp\
bmZyYXN0cnVjdHVyZSBzZXJ2aWNlcyAoR29ncywgQ2hlLCAuLi4pCiAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICBkZWZhdWx0OiAiYWRtaW51c2VyIgogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBk\
aXNwbGF5X3R5cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91cDogV29ya3Nob3AgSW5mcmEgU2Vy\
dmljZXMKICAgIC0gbmFtZTogaW5mcmFzdmNzX2FkbV9wd2QKICAgICAgdGl0bGU6IEluZnJhIFNl\
cnZpY2VzIEFkbWluIFBhc3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBBZG1pbiBwYXNzd29yZCBm\
b3IgaW5mcmFzdHJ1Y3R1cmUgc2VydmljZXMgKEdvZ3MsIENoZSwgLi4uKQogICAgICB0eXBlOiBz\
dHJpbmcKICAgICAgZGVmYXVsdDogImFkbWlucHdkIgogICAgICByZXF1aXJlZDogdHJ1ZQogICAg\
ICBkaXNwbGF5X3R5cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91cDogV29ya3Nob3AgSW5mcmEg\
U2VydmljZXM="

COPY playbooks /opt/apb/actions
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
